<nav>
  <form data-controller="form" data-action="input->form#requestSubmit formdata->form#mergeWithSearchParams">
    <%= fields "", model: @search do |form| %>
      <%= form.label :q, "Search" %>
      <%= form.search_field :q, data: { focus_target: "element", turbo_permanent: true } %>

      <noscript>
        <button>Submit</button>
      </noscript>
    <% end %>
  </form>
</nav>

<main>
  <aside>
    <form data-controller="form" data-action="input->form#requestSubmit formdata->form#mergeWithSearchParams">
      <%= fields "", model: @search do |form| %>
        <%= form.label :deactivated %>
        <%= form.check_box :deactivated, data: { focus_target: "element" } %>

        <%= form.label :first_purchase_on_minimum, "First purchase after" %>
        <%= form.date_field :first_purchase_on_minimum, data: { focus_target: "element" } %>

        <%= form.label :first_purchase_on_maximum, "First purchase before" %>
        <%= form.date_field :first_purchase_on_maximum, data: { focus_target: "element" } %>

        <noscript>
          <button>Submit</button>
        </noscript>
      <% end %>
    </form>
  </aside>

  <table>
    <caption>Customers</caption>

    <thead>
      <tr>
        <th>Name</th>
        <th>Email address</th>
        <th>First purchase</th>
        <th>Last purchase</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody>
      <% @customers.each do |customer| %>
        <tr>
          <td><%= customer.name %></td>
          <td><%= customer.email_address %></td>
          <td><%= customer.first_purchase_on %></td>
          <td><%= customer.last_purchase_on %></td>
          <td>
            <% if customer.deactivated_on&.past? %>
              Deactivated
            <% else %>
              Active
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</main>
